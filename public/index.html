<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تحلیلگر پیشرفته بازار</title>
  <style>
    /* استایل‌های قبلی را حفظ کنید و این استایل‌های جدید را اضافه کنید */
    
    .gauge-container {
      width: 200px;
      height: 200px;
      margin: 20px auto;
      position: relative;
    }
    
    .gauge-body {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #f5f5f5;
      position: relative;
      overflow: hidden;
      border: 10px solid #e0e0e0;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .gauge-fill {
      position: absolute;
      top: 0;
      left: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, #e74c3c 0%, #f1c40f 50%, #27ae60 100%);
      transform-origin: right center;
      transform: rotate(0deg);
      transition: transform 1s ease-out;
    }
    
    .gauge-cover {
      width: 80%;
      height: 80%;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 10%;
      left: 10%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
    }
    
    .gauge-needle {
      width: 4px;
      height: 50%;
      background: #2c3e50;
      position: absolute;
      top: 50%;
      left: 50%;
      transform-origin: bottom center;
      transform: translateX(-50%) rotate(0deg);
      transition: transform 1s ease-out;
      z-index: 10;
    }
    
    .gauge-labels {
      position: absolute;
      width: 100%;
      text-align: center;
      top: 110%;
    }
    
    .gauge-label {
      font-size: 14px;
      font-weight: bold;
      display: inline-block;
      margin: 0 10px;
    }
    
    .buyer-label {
      color: #27ae60;
    }
    
    .seller-label {
      color: #e74c3c;
    }
  </style>
</head>
<body>
  <!-- کدهای قبلی را حفظ کنید -->

  <script>
    // تابع نمایش پیشرفته نتایج با نمایشگر عقربه‌ای
    function renderAdvancedAnalysis(data) {
      // محاسبه زاویه عقربه (از -90 تا 90 درجه)
      const netPower = data.signal.buyerPower - data.signal.sellerPower;
      const needleAngle = (netPower / 100) * 180 - 90;
      
      document.getElementById('analysis-result').innerHTML = `
        <div class="card">
          <h2>${data.name} (${data.symbol})</h2>
          <p>آخرین قیمت: <strong>${data.lastPrice.toLocaleString('fa-IR')}</strong></p>
        </div>
        
        <div class="card">
          <h3>نمودار قدرت بازار</h3>
          <div class="gauge-container">
            <div class="gauge-body">
              <div class="gauge-fill"></div>
              <div class="gauge-needle" style="transform: translateX(-50%) rotate(${needleAngle}deg)"></div>
              <div class="gauge-cover">${data.signal.decision}</div>
            </div>
            <div class="gauge-labels">
              <span class="gauge-label seller-label">فروشندگان: ${data.signal.sellerPower}%</span>
              <span class="gauge-label buyer-label">خریداران: ${data.signal.buyerPower}%</span>
            </div>
          </div>
          <p style="text-align: center; margin-top: 20px;">
            میزان اطمینان: <strong>${data.signal.confidence}%</strong>
          </p>
          <div class="signal-details">
            <ul>
              ${data.signal.details.map(item => `<li>${item}</li>`).join('')}
            </ul>
          </div>
        </div>
        
        <div class="card">
          <h3>اندیکاتورهای تکنیکال</h3>
          <div class="indicator"><span>RSI (14):</span> <strong>${data.indicators.rsi.toFixed(2)}</strong></div>
          <div class="indicator"><span>SMA (50):</span> <strong>${data.indicators.sma50.toLocaleString('fa-IR')}</strong></div>
          <div class="indicator"><span>SMA (200):</span> <strong>${data.indicators.sma200.toLocaleString('fa-IR')}</strong></div>
          <div class="indicator"><span>EMA (20):</span> <strong>${data.indicators.ema20.toLocaleString('fa-IR')}</strong></div>
          <div class="indicator"><span>MACD:</span> <strong>${data.indicators.macd.MACD.toFixed(4)}</strong></div>
        </div>
        
        <p style="text-align: center; color: #666; font-size: 0.9em;">
          آخرین به‌روزرسانی: ${new Date(data.lastUpdate).toLocaleString('fa-IR')}
        </p>
      `;
    }

    // بقیه کدها بدون تغییر
  </script>
</body>
</html>
